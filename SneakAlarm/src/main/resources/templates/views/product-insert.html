<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="layout/default">

<th:block layout:fragment="css">
  <link rel="stylesheet" th:href="@{css/product-insert}" />
</th:block>

<th:block layout:fragment="script">
	<script src="https://sdk.amazonaws.com/js/aws-sdk-2.283.1.min.js"></script>
	<script>
		var albumBucketName = 'sneakalarm.media';
		var bucketRegion = 'ap-northeast-2';
		var IdentityPoolId = 'ap-northeast-2:e33e44cf-1621-4149-98b8-9dd28c45ecc8';
		
		AWS.config.update({
			  region: bucketRegion,
			  credentials: new AWS.CognitoIdentityCredentials({ IdentityPoolId: IdentityPoolId })
		});
		
		var s3 = new AWS.S3({
			  apiVersion: '2006-03-01',
			  params: {Bucket: albumBucketName}
		});
		
		
		function addPhoto() {
			var albumName = document.getElementById('code').value;
			  var files = document.getElementById('photoupload').files;
			  console.log('got files');
			  if (!files.length) {
			    return alert('Please choose a file to upload first.');
			  }
			  var file = files[0];
			  var fileName = file.name;
			  var albumPhotosKey = 'product/'+encodeURIComponent(albumName) + '/';
				console.log('albumPhotosKey:'+albumPhotosKey);
			  var photoKey = albumPhotosKey + fileName;
			  s3.upload({
			    Key: photoKey,
			    Body: file,
			    ACL: 'public-read'
			  }, function(err, data) {
			    if (err) {
			      return alert('There was an error uploading your photo: ', err.message);
			    }
			    alert('Successfully uploaded photo.');
			    //viewAlbum(albumName);
			  });
		}
	</script>
</th:block>

<div layout:fragment="content">
<div class="container-fluid d-flex justify-content-center" style="margin-top:210px">
<div>
<h1 class="text-center mb-3">제품 등록</h1>
<form action="/product-insert" method="post" style="width:1000px">
  <div class="mb-3 row">
		<label for="name" class="col-sm-2 col-form-label text-center">제품 명</label>
			<div class="col-sm-10">
				<input type="text" class="form-control" id="name" name="name" required="required"/>
			</div>
	</div>
	<div class="mb-3 row">
		<label for="code" class="col-sm-2 col-form-label text-center">상품 코드</label>
			<div class="col-sm-10">
				<input type="text" class="form-control" id="code" name="code" required="required"/>
			</div>
	</div>
	<div class="mb-3 row">
		<label for="price" class="col-sm-2 col-form-label text-center">발매 가격</label>
			<div class="col-sm-10">
				<input type="text" class="form-control" id="price" name="price" required="required"/>
			</div>
	</div>
	<div class="mb-3 row">
		<label for="brand" class="col-sm-2 col-form-label text-center">브랜드</label>
			<div class="col-sm-10">
				<input type="text" class="form-control" id="brand" name="brand" required="required"/>
			</div>
	</div>
	<div class="mb-3 row">
		<label for="content" class="col-sm-2 col-form-label text-center">내용</label>
			<div class="col-sm-10">
				<textarea class="form-control" id="content" name="content" rows="15" cols="5" required="required"></textarea>
			</div>
	</div>
	<div class="mb-3 row">
 			<label for="photoupload" class="col-sm-2 col-form-label text-center">이미지</label>
 			<div class="col-sm-10">
 			<input class="form-control form-control-lg" type="file" id="photoupload" name="fileList" multiple required="required">
 			</div>
	</div>
	<div class="mb-3 row">
		<button type="submit" class="btn btn-primary col-sm-12" onclick="addPhoto()">등록</button>
	</div>
</form>
</div>
</div>
</div>
</html>